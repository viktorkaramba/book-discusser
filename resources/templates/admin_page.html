<div class="bg-img">
<div class="main-flex-container">
  {{ template "header.html" .}}
    <div class="my_main">
    <!--Loop over the payload variable, which is the list of articles-->
    {{range .payload }}
    <div class="container book-list">
      <!--Create the link for the article based on its ID-->
      <div class="flex-container" style="align-items: flex-start">
        <div style="flex-grow: 1; max-width: 200px;">
          <div style="width: 200px; height: 300px">
            <img src="{{.ImageBook}}" width="100%" height="100%" class="book-img">
          </div>
        </div>
        <div style="flex-grow: 7;" id="read_div_{{.ID}}">
          <a style="color: #222222" href="/api/comments/{{.ID}}">
            <!--Display the title of the article -->
            <h2>{{.Name}}</h2>
          </a>
          <h4 style="color: #222222">{{.Author}}</h4>
          <div>{{.Description}}</div>
        </div>
        <div style="flex-grow: 7; display: none" id="edit_div_{{.ID}}">
          <div>
            <label>Enter New Book Name:</label>
            <input class="form-control"
                   type="text"
                   name="name"
                   id="name_{{.ID}}"
                   value="{{.Name}}"
                   placeholder="Input Book Name Here">
          </div>
          <label>Enter New Author:</label>
          <input class="form-control"
                 type="text"
                 name="author"
                 id="author_{{.ID}}"
                 value="{{.Author}}"
                 placeholder="Input Author Here">
          <label>Enter New Description:</label>
          <textarea
                  class="form-control"
                  name="description"
                  rows="5"
                  cols="100"
                  id="description_{{.ID}}"
          >
                {{.Description}}
            </textarea>
          <label>Enter New ImageLink:</label>
          <input class="form-control"
                 type="text"
                 name="imageLink"
                 id="imageLink_{{.ID}}"
                 placeholder="Input Image Link Here">
        </div>
        <div style="flex-grow: 1;  max-width: 20px;">
          <img src="img/edit.svg" id="edit_img_{{.ID}}" style="display: block;" onclick="edit({{.ID}})" alt="">
          <img src="img/accept.svg" id="accept_img_{{.ID}}" style="width: 20px; height: 20px; display: none; margin-bottom: 5px"  onclick="sendData({{.ID}},{{.ImageBook}})" alt="">
          <img src="img/stop.svg" id="stop_img_{{.ID}}" style="width: 20px; height: 20px;  display: none" onclick="stop({{.ID}})" alt="">
        </div>
      </div>

    </div>
    {{end}}
    <!--Embed the footer.html template at this location-->
  </div>
  </div>
{{ template "footer.html" .}}
</div>
<script>

function edit(id){
  document.getElementById("edit_img_".concat(id)).style.display = "none";
  document.getElementById("accept_img_".concat(id)).style.display = "block";
  document.getElementById("stop_img_".concat(id)).style.display = "block";
  document.getElementById("edit_div_".concat(id)).style.display = "block";
  document.getElementById("read_div_".concat(id)).style.display = "none";
}

function stop(id){
  document.getElementById("edit_img_".concat(id)).style.display = "block";
  document.getElementById("accept_img_".concat(id)).style.display = "none";
  document.getElementById("stop_img_".concat(id)).style.display = "none";
  document.getElementById("edit_div_".concat(id)).style.display = "none";
  document.getElementById("read_div_".concat(id)).style.display = "block";
}

function sendData(id, imageBook){
  const name = document.getElementById('name_'.concat(id)).value;
  const author = document.getElementById('author_'.concat(id)).value;
  const description = document.getElementById('description_'.concat(id)).value;
  let image = document.getElementById('imageLink_'.concat(id)).value;
  if(image === ""){
    image = imageBook;
  }
  const data = {name: name, author: author, description: description, imageBook: image};
  fetch('http://localhost:8080/api/books/' + id, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(data)
  })
          .then(data => {
            if(data.status === 401){
              location.replace("http://localhost:8080/auth/view/login")
            }
            else if (data.status === 200){
              location.replace("http://localhost:8080/api/books")
              console.log('Success:', data.json());
            }
          })
          .catch((error) => {
            console.error('Error:', error);
          })
}

</script>